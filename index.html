<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONURB - Reda√ß√£o Paran√°</title>
    <link rel="icon" href="https://static.wikia.nocookie.net/bb9e0e0f-96b2-4245-9568-4a0eba75ced7/scale-to-width/755">
    <style>
        /* ===================================
           CONFIGURA√á√ïES GERAIS DO SITE
           =================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ===================================
           CORPO DA P√ÅGINA E FUNDO
           =================================== */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(0, 0, 0, 0.1) 100%),
                url('https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3Nmw2ZjA0Y2pnMzVreTYzb3c2ZzUxbGVqamgwMWI1ZzFuYXFwZWk5MSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/nURzWHsOTpDDa/giphy.gif');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
            padding: 20px;
            color: #ffffff;
            transition: background-image 0.5s ease-in-out;
        }

        /* ===================================
           CONTAINER PRINCIPAL
           =================================== */
        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* ===================================
           CABE√áALHO (HEADER)
           üé® Personalize aqui: cor de fundo, bordas, sombras
           =================================== */
        .header {
            background: rgba(2, 0, 2, 0.26); /* ‚Üê TRANSPAR√äNCIA: 0.75 = 75% opaco */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgb(252, 252, 252);
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid rgba(0, 0, 0, 0); /* ‚Üê COR DA BORDA */
        }

        .header h1 {
            color: #ffffff; /* ‚Üê COR DO T√çTULO */
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            color: #0867e2; /* ‚Üê COR DO SUBT√çTULO */
            font-size: 1.1em;
        }

        /* ===================================
           CARDS/CAIXAS DE CONTE√öDO
           üé® Personalize aqui: transpar√™ncia, bordas, sombras
           =================================== */
        .card {
            background: rgba(0, 0, 0, 0.493); /* ‚Üê TRANSPAR√äNCIA: 0.70 = 70% opaco */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgb(0, 0, 0);
            margin-bottom: 20px;
            border: 2px solid rgba(0, 0, 0, 0); /* ‚Üê COR DA BORDA */
        }

        /* ===================================
           CAMPOS DE ENTRADA (INPUTS)
           =================================== */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff; /* ‚Üê COR DOS R√ìTULOS */
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #332e2e; /* ‚Üê COR DA BORDA DOS INPUTS */
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.432); /* ‚Üê FUNDO DOS INPUTS (transpar√™ncia) */
            color: #ffffff; /* ‚Üê COR DO TEXTO */
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #2918c5; /* ‚Üê COR DA BORDA QUANDO FOCADO */
            background: rgba(0, 0, 0, 0.623); /* ‚Üê FUNDO MAIS ESCURO QUANDO FOCADO */
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* ===================================
           BOT√ïES
           üé® Personalize cores e efeitos dos bot√µes
           =================================== */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        /* Bot√£o Principal (Azul) */
        .btn-primary {
            background: linear-gradient(135deg, #000000 0%, #113494 100%); /* ‚Üê GRADIENTE DO BOT√ÉO */
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgb(255, 255, 255); /* ‚Üê SOMBRA AO PASSAR O MOUSE */
        }

        /* Bot√£o Secund√°rio */
        .btn-secondary {
            background: rgba(9, 24, 156, 0.70); /* ‚Üê FUNDO COM TRANSPAR√äNCIA */
            color: white;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: rgba(9, 44, 141, 0.85);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===================================
           ITEMS DE REDA√á√ÉO (LISTA)
           üé® Personalize apar√™ncia dos cards de reda√ß√£o
           =================================== */
        .redacao-item {
            background: rgba(49, 53, 58, 0.75); /* ‚Üê TRANSPAR√äNCIA DOS CARDS DE REDA√á√ÉO */
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #2040a8; /* ‚Üê BORDA ESQUERDA COLORIDA */
            cursor: pointer;
            transition: all 0.3s;
        }

        .redacao-item:hover {
            background: rgba(57, 60, 63, 0.85); /* ‚Üê FUNDO AO PASSAR O MOUSE */
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(32, 64, 168, 0.4);
        }

        .redacao-item h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #fff;
        }

        .redacao-item p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #ccc;
        }

        /* ===================================
           BADGES DE STATUS
           üé® Cores das etiquetas de status
           =================================== */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 10px;
        }

        .status-aberto { background: #4CAF50; color: white; } /* ‚Üê Verde */
        .status-rascunho { background: #FFC107; color: #333; } /* ‚Üê Amarelo */
        .status-correcao { background: #FF9800; color: white; } /* ‚Üê Laranja */

        /* ===================================
           ALERTAS/NOTIFICA√á√ïES
           üé® Cores e estilos dos alertas
           =================================== */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 2px solid;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: rgba(212, 237, 218, 0.95);
            color: #155724;
            border-color: #28a745;
        }

        .alert-error {
            background: rgba(248, 215, 218, 0.95);
            color: #721c24;
            border-color: #dc3545;
        }

        .alert-warning {
            background: rgba(255, 243, 205, 0.95);
            color: #856404;
            border-color: #ffc107;
        }

        .alert-info {
            background: rgba(209, 236, 241, 0.95);
            color: #0c5460;
            border-color: #17a2b8;
        }

        /* ===================================
           LOADING/CARREGAMENTO
           =================================== */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid rgba(7, 66, 177, 0.3);
            border-top: 4px solid #ffffff; /* ‚Üê COR DO SPINNER */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===================================
           BARRA DE PROGRESSO
           üé® Personalize cores da barra de progresso
           =================================== */
        .progress-bar {
            background: rgba(224, 224, 224, 0.3); /* ‚Üê FUNDO DA BARRA */
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #0867e2 0%, #1d4ac5 100%); /* ‚Üê GRADIENTE DA BARRA */
            height: 100%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* ===================================
           CONTADOR DE PALAVRAS
           =================================== */
        .word-count {
            text-align: right;
            color: #ccc; /* ‚Üê COR DO TEXTO */
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* ===================================
           CLASSE PARA ESCONDER ELEMENTOS
           =================================== */
        .hidden {
            display: none;
        }

        /* ===================================
           INDICADOR DE ETAPAS (STEPS)
           üé® Personalize apar√™ncia dos passos
           =================================== */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            position: relative;
            color: #fff;
        }

        .step::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: rgba(224, 224, 224, 0.3);
            z-index: -1;
        }

        .step:last-child::after {
            display: none;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(21, 62, 175, 0.5); /* ‚Üê FUNDO DO N√öMERO */
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step.active .step-number {
            background: #0867e2; /* ‚Üê COR QUANDO ATIVO */
            box-shadow: 0 0 20px rgba(8, 103, 226, 0.6);
        }

        .step.completed .step-number {
            background: #28a745; /* ‚Üê COR QUANDO COMPLETO (Verde) */
        }

        /* ===================================
           CONFIGURA√á√ÉO DE API
           =================================== */
        .api-config {
            background: rgba(0, 0, 0, 0.363); /* ‚Üê TRANSPAR√äNCIA DA CAIXA DE API */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.3);
        }

        .api-config h4 {
            margin-bottom: 10px;
            color: #ffffff; /* ‚Üê COR DO T√çTULO */
        }

        /* ===================================
           SE√á√ÉO DE TOKEN
           =================================== */
        .token-section {
            background: rgba(37, 35, 37, 0.65); /* ‚Üê TRANSPAR√äNCIA DA SE√á√ÉO DE TOKEN */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #0867e2; /* ‚Üê BORDA ESQUERDA COLORIDA */
        }

        .token-section h4 {
            color: #fff;
            margin-bottom: 10px;
        }

        /* ===================================
           TEXTOS PEQUENOS E C√ìDIGO
           =================================== */
        small {
            color: #ccc;
            display: block;
            margin-top: 5px;
        }

        code {
            background: rgba(51, 51, 51, 0.8);
            color: #0867e2; /* ‚Üê COR DO C√ìDIGO */
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        /* ===================================
           CONSOLE DE DEBUG
           =================================== */
        #debugConsole {
            background: rgba(0, 0, 0, 0.95); /* ‚Üê FUNDO DO CONSOLE */
            color: #135013; /* ‚Üê COR DO TEXTO (Verde Matrix) */
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }

        /* ===================================
           BOT√ïES DE CONTROLE (CANTO DIREITO)
           üé® Personalize posi√ß√£o e apar√™ncia dos bot√µes fixos
           =================================== */
        .control-buttons {
            position: fixed;
            bottom: 20px; /* ‚Üê DIST√ÇNCIA DO FUNDO */
            right: 20px; /* ‚Üê DIST√ÇNCIA DA DIREITA */
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-size: 14px;
        }

        /* Bot√£o Debug (Roxo) */
        .debug-btn {
            background: #03011f;
            color: white;
        }

        .debug-btn:hover {
            background: #03011f;
            transform: scale(1.05);
        }

        /* Bot√£o Trocar Fundo (Rosa/Vermelho) */
        .bg-btn {
            background: linear-gradient(135deg, #000000 0%, #030a44 100%);
            color: white;
        }

        .bg-btn:hover {
            background: linear-gradient(135deg, #000000 0%, #030a44 100%);
            transform: scale(1.05);
        }

        /* Bot√£o Home (Azul Claro) */
        .home-btn {
            background: linear-gradient(135deg, #000000 0%, #030a44 100%);
            color: white;
        }

        .home-btn:hover {
            background: linear-gradient(135deg, #000000 0%, #030a44 100%);
            transform: scale(1.05);
        }

        /* Bot√£o Zen (Verde √Ågua/Rosa) */
        .zen-btn {
            background: linear-gradient(135deg, #000000 0%, #030a44 100%);
            color: #333;
        }

        .zen-btn:hover {
            background: linear-gradient(135deg, #000000 0%, #030a44 100%);
            transform: scale(1.05);
        }

        /* Modo Zen */
        body.zen-mode .container {
            display: none;
        }

        body.zen-mode .control-buttons {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .zen-message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 1.5em;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 0.5s ease-in-out;
        }

        body.zen-mode .zen-message {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            to {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        kbd {
            background: rgba(51, 51, 51, 0.8);
            color: #fff;
            border: 1px solid rgba(85, 85, 85, 0.8);
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
        }

        a {
            color: #0867e2;
            text-decoration: none;
        }

        a:hover {
            color: #1d4ac5;
            text-decoration: underline;
        }

        /* Tela Inicial */
        .welcome-screen {
            text-align: center;
            padding: 50px 20px;
        }

        .welcome-screen h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(8, 103, 226, 0.5);
        }

        .welcome-screen p {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #ffffff;
            line-height: 1.6;
        }

        .welcome-screen .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .feature-card {
            background: rgba(26, 26, 26, 0.6);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid rgba(8, 103, 226, 0.3);
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(8, 103, 226, 0.4);
            border-color: #0867e2;
        }

        .feature-card h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .feature-card p {
            font-size: 1em;
            color: #ffffff;
        }

        .start-btn {
            padding: 20px 50px;
            font-size: 1.3em;
            background: linear-gradient(135deg, #000000 0%, #19306e 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(8, 103, 226, 0.4);
        }

        .start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(8, 103, 226, 0.6);
        }

    </style>
</head>
<body>
    <!-- ====================================================================
         CONTAINER PRINCIPAL
         ==================================================================== -->
    <div class="container">
        
        <!-- ================================================================
             üìç SE√á√ÉO: CABE√áALHO (HEADER)
             Localiza√ß√£o: /header
             Personalize: T√≠tulo e subt√≠tulo do site
             ================================================================ -->
        <div class="header">
            <h1>üéì Reda√ß√£o Paran√°</h1>
            <p>Louvado seja o Senhor Jesus pela Tecnologia</p>
        </div>

        <!-- ================================================================
             üìç SE√á√ÉO: CAIXA DE ALERTAS
             Localiza√ß√£o: /alertas
             ================================================================ -->
        <div id="alertBox" class="alert"></div>

        <!-- ================================================================
             üìç SE√á√ÉO: CONSOLE DE DEBUG
             Localiza√ß√£o: /debug
             ================================================================ -->
        <div id="debugConsole" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #00ff00;">üêõ Console de Debug</h3>
                <button onclick="document.getElementById('debugConsole').classList.add('hidden')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Fechar</button>
            </div>
            <div id="debugOutput" style="font-size: 12px; line-height: 1.6;"></div>
        </div>

        <!-- ================================================================
             üìç ETAPA 0: TELA INICIAL (WELCOME SCREEN)
             Localiza√ß√£o: /welcome
             Personalize: Mensagem de boas-vindas e features
             ================================================================ -->
        <div id="welcomeScreen" class="card welcome-screen">
            <h2>‚ú® Bem-vindo ao Automatizador de Reda√ß√µes ‚ú®</h2>
            <p>Simplifique o processo de envio das suas reda√ß√µes com intelig√™ncia artificial!</p>
            
            <div class="features">
                <div class="feature-card">
                    <h3>IA Integrada</h3>
                    <p>Gere reda√ß√µes automaticamente usando Groq, OpenAI ou Claude</p>
                </div>
                <div class="feature-card">
                    <h3>Envio R√°pido</h3>
                    <p>Processo automatizado em 4 etapas simples e eficientes</p>
                </div>
                <div class="feature-card">
                    <h3>Seguro</h3>
                    <p>Seus tokens s√£o usados apenas localmente no navegador</p>
                </div>
            </div>

            <button class="start-btn" onclick="iniciarAutomacao()">
                Iniciar
            </button>

            <div style="margin-top: 40px; color: #666; font-size: 0.9em;">
                <p>Desenvolvido com ‚ù§Ô∏è e üíª por Bruno & Maria & Ana</p>
            </div>
        </div>

        <!-- ================================================================
             üìç ETAPA 1: AUTENTICA√á√ÉO
             Localiza√ß√£o: /auth ou /autenticacao ou /bearer
             Personalize: Campos de token e API keys
             ================================================================ -->
        <div id="step1" class="card hidden">
            <h2 style="margin-bottom: 20px;">üîê Autentica√ß√£o</h2>
            
            <!-- Instru√ß√µes de como pegar o token -->
            <div class="token-section">
                <h4>üìã Como pegar os tokens:</h4>
                <ol style="margin-left: 20px; line-height: 1.8; color: #ccc;">
                    <li>Abra <a href="https://redacao.pr.gov.br" target="_blank">redacao.pr.gov.br</a></li>
                    <li>Fa√ßa login com sua conta Google</li>
                    <li>Pressione <kbd>F12</kbd> ‚Üí <strong>Network</strong> ‚Üí <strong>Authorization</strong></li>
                    <li>Copie o valor de <code>token</code> (come√ßa com eyJ...)</li>
                </ol>
                <div style="background: rgba(0, 0, 0, 0.5); padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <strong>üí° Dica:</strong> O token expira ap√≥s algumas horas!
                </div>
            </div>

            <!-- Campo do link (opcional) -->
            <div class="input-group">
                <label>üîó Link completo (opcional):</label>
                <textarea id="linkInput" placeholder="https://redacao.pr.gov.br/#state=8&access_token=ya29..."></textarea>
                <small>Cole o link completo da URL</small>
            </div>

            <!-- Campo do Bearer Token (obrigat√≥rio) -->
            <div class="input-group">
                <label>üé´ Bearer Token (Obrigat√≥rio):</label>
                <textarea id="bearerInput" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."></textarea>
                <small>Cole o token do Local Storage</small>
            </div>

            <!-- Configura√ß√£o da IA -->
            <div class="api-config">
                <h4>ü§ñ Configura√ß√£o da IA (Opcional)</h4>
                <div class="input-group">
                    <label>Provedor:</label>
                    <select id="aiProvider">
                        <option value="groq">Groq (Gratuito - Recomendado)</option>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Claude</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>API Key (vazio = texto exemplo):</label>
                    <input type="password" id="apiKey" placeholder="sk-...">
                    <small>Groq gratuito: <a href="https://console.groq.com/" target="_blank">console.groq.com</a></small>
                </div>
            </div>

            <!-- Bot√£o de conectar -->
            <button class="btn btn-primary" onclick="authenticate()">
                üöÄ Conectar
            </button>
        </div>

        <!-- ================================================================
             üìç ETAPA 2: SELE√á√ÉO DE REDA√á√ÉO
             Localiza√ß√£o: /selecao ou /redacoes
             ================================================================ -->
        <div id="step2" class="card hidden">
            <h2 style="margin-bottom: 20px;">üìã Escolha uma Reda√ß√£o</h2>
            <div id="redacoesList"></div>
        </div>

        <!-- ================================================================
             üìç ETAPA 3: EDI√á√ÉO DA REDA√á√ÉO
             Localiza√ß√£o: /edicao ou /texto
             ================================================================ -->
        <div id="step3" class="card hidden">
            <h2 style="margin-bottom: 20px;">üìù Reda√ß√£o Gerada</h2>
            
            <!-- Loading (carregando IA) -->
            <div id="loadingGeneration" class="loading hidden">
                <div class="spinner"></div>
                <p>Gerando com IA...</p>
            </div>

            <!-- Editor de texto -->
            <div id="textEditor" class="hidden">
                <div class="input-group">
                    <label>Texto:</label>
                    <textarea id="textoRedacao" style="min-height: 300px; font-family: Georgia, serif; line-height: 1.8;"></textarea>
                    <div class="word-count" id="wordCount">0 palavras</div>
                </div>

                <div class="input-group">
                    <label>T√≠tulo:</label>
                    <input type="text" id="tituloRedacao">
                </div>

                <!-- Bot√µes de a√ß√£o -->
                <button class="btn btn-primary" onclick="enviarRedacao()">
                    üì§ Enviar
                </button>
                <button class="btn btn-secondary" onclick="voltarParaLista()">
                    ‚Üê Voltar
                </button>
            </div>
        </div>

        <!-- ================================================================
             üìç ETAPA 4: PROGRESSO DO ENVIO
             Localiza√ß√£o: /envio ou /progresso
             ================================================================ -->
        <div id="step4" class="card hidden">
            <h2 style="margin-bottom: 20px;">üöÄ Enviando</h2>
            
            <!-- Indicador de etapas -->
            <div class="step-indicator">
                <div class="step" id="stepSave">
                    <div class="step-number">1</div>
                    <div>Salvar</div>
                </div>
                <div class="step" id="stepSpell">
                    <div class="step-number">2</div>
                    <div>Ortografia</div>
                </div>
                <div class="step" id="stepWait">
                    <div class="step-number">3</div>
                    <div>Aguardar</div>
                </div>
                <div class="step" id="stepSend">
                    <div class="step-number">4</div>
                    <div>Enviar</div>
                </div>
            </div>

            <!-- Barra de progresso -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
            </div>

            <!-- Texto de status -->
            <div id="progressText" style="text-align: center; color: #ccc; margin-top: 15px;">
                Iniciando...
            </div>
        </div>
    </div>

    <!-- ====================================================================
         üìç SE√á√ÉO: BOT√ïES DE CONTROLE FIXOS
         Localiza√ß√£o: /controles ou /botoes
         Posi√ß√£o: Canto inferior direito
         ==================================================================== -->
    <div class="control-buttons">
        <button class="control-btn home-btn" onclick="voltarParaHome()" title="Voltar para o in√≠cio">
            Home
        </button>
        <button class="control-btn zen-btn" onclick="toggleZenMode()" title="Modo Zen - S√≥ o GIF">
            Relaxar
        </button>
        <button class="control-btn bg-btn" onclick="trocarFundo()" title="Trocar fundo de gatinho">
            Trocar de Fundo
        </button>
        <button class="control-btn debug-btn" onclick="toggleDebug()" title="Abrir console de debug">
            Debuga
        </button>
    </div>

    <!-- ====================================================================
         üìç SE√á√ÉO: MENSAGEM DO MODO ZEN
         Localiza√ß√£o: /zen
         ==================================================================== -->
    <div class="zen-message">
        <div style="font-size: 3em; margin-bottom: 20px;">üßò‚ú®</div>
        <div>Modo Relaxado Ativado kkkkk</div>
        <div style="font-size: 0.7em; margin-top: 15px; opacity: 0.8;">
            Relaxe e aprecie o gatinho üê±
        </div>
        <div style="font-size: 0.6em; margin-top: 10px; opacity: 0.6;">
            Clique em "üßò Relaxar" novamente para voltar
        </div>
    </div>

    <!-- ====================================================================
         üìç IN√çCIO DO JAVASCRIPT
         Localiza√ß√£o: /script
         ==================================================================== -->
    <script>
        // ===== CONFIGURA√á√ÉO DOS FUNDOS =====
        const fundos = [
            'https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3Nmw2ZjA0Y2pnMzVreTYzb3c2ZzUxbGVqamgwMWI1ZzFuYXFwZWk5MSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/nURzWHsOTpDDa/giphy.gif',
            'https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3aHR2enp0MTQya3RtZHhsYXJrcm5idXZydmhyaXhhZWxzMHZobTUxaiZlcD12MV9naWZzX3JlbGF0ZWQmY3Q9Zw/w3J7mstYCISqs/giphy.gif',
            // üé® ADICIONE MAIS GIFS DE GATINHO AQUI:
            'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif',
            'https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif',
            'https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif',
            'https://media.giphy.com/media/vFKqnCdLPNOKc/giphy.gif',
            // Adicione mais URLs aqui...
        ];
        
        let fundoAtual = 0;

        function trocarFundo() {
            fundoAtual = (fundoAtual + 1) % fundos.length;
            const novoFundo = `linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.1) 100%), url('${fundos[fundoAtual]}')`;
            document.body.style.background = novoFundo;
            document.body.style.backgroundSize = 'cover';
            document.body.style.backgroundPosition = 'center';
            document.body.style.backgroundAttachment = 'fixed';
            showAlert(`üê± Fundo trocado! (${fundoAtual + 1}/${fundos.length})`, 'info');
        }

        function voltarParaHome() {
            // Esconde todas as etapas
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
            // Mostra a tela de boas-vindas
            document.getElementById('welcomeScreen').classList.remove('hidden');
            showAlert('üè† Voltou para o in√≠cio!', 'info');
        }

        function toggleZenMode() {
            const isZenMode = document.body.classList.toggle('zen-mode');
            const zenMsg = document.querySelector('.zen-message');
            
            if (isZenMode) {
                // ATIVANDO modo Zen
                console.log('üßò Modo Zen ATIVADO');
                document.getElementById('debugConsole').classList.add('hidden');
                
                // Mostra mensagem e esconde ap√≥s 3 segundos
                if (zenMsg) {
                    zenMsg.style.display = 'block';
                    zenMsg.style.animation = 'fadeIn 0.5s ease-in-out';
                    
                    setTimeout(() => {
                        if (document.body.classList.contains('zen-mode')) {
                            zenMsg.style.animation = 'fadeOut 0.5s ease-in-out';
                            setTimeout(() => {
                                zenMsg.style.display = 'none';
                            }, 500);
                        }
                    }, 3000);
                }
            } else {
                // DESATIVANDO modo Zen
                console.log('üßò Modo Zen DESATIVADO');
                
                // Esconde a mensagem imediatamente
                if (zenMsg) {
                    zenMsg.style.display = 'none';
                }
                
                showAlert('üëÅÔ∏è Voltou ao normal!', 'info');
            }
        }

        function iniciarAutomacao() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('step1').classList.remove('hidden');
            showAlert('‚ú® Vamos come√ßar!', 'success');
        }

        // ===== VARI√ÅVEIS GLOBAIS =====
        let token = null;
        let studentId = null;
        let redacoes = [];
        let redacaoSelecionada = null;
        let detalhesRedacao = null;
        let apiKey = null;
        let aiProvider = 'groq';

        const baseURL = 'https://redacao-api.pr.gov.br/api/v2';

        // ===== SISTEMA DE DEBUG =====
        function toggleDebug() {
            document.getElementById('debugConsole').classList.toggle('hidden');
        }

        function debugLog(message, type = 'info') {
            const output = document.getElementById('debugOutput');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff5555' : type === 'success' ? '#50fa7b' : '#00ff00';
            output.innerHTML += `<div style="color: ${color};">[${time}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        const originalLog = console.log;
        const originalError = console.error;
        console.log = function(...args) {
            originalLog.apply(console, args);
            debugLog(args.join(' '), 'info');
        };
        console.error = function(...args) {
            originalError.apply(console, args);
            debugLog('‚ùå ' + args.join(' '), 'error');
        };

        function showAlert(message, type = 'info') {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = `alert alert-${type} show`;
            alertBox.textContent = message;
            setTimeout(() => alertBox.classList.remove('show'), 5000);
        }

        function decodeJWT(token) {
            try {
                const payload = token.split('.')[1];
                return JSON.parse(atob(payload));
            } catch (e) {
                throw new Error('Token JWT inv√°lido');
            }
        }

        // ===== AUTENTICA√á√ÉO =====
        async function authenticate() {
            const bearerInput = document.getElementById('bearerInput').value.trim();
            apiKey = document.getElementById('apiKey').value.trim() || null;
            aiProvider = document.getElementById('aiProvider').value;
            
            console.log('üîê Iniciando autentica√ß√£o...');

            if (!bearerInput) {
                showAlert('Por favor, insira o Bearer Token!', 'error');
                return;
            }

            token = bearerInput.replace(/^Bearer\s+/i, '').trim();
            
            if (token.split('.').length !== 3) {
                showAlert('Token inv√°lido!', 'error');
                return;
            }

            try {
                const payload = decodeJWT(token);
                studentId = payload.sid;
                
                console.log('‚úÖ Autenticado! ID:', studentId);
                showAlert('‚úÖ Autenticado! ID: ' + studentId, 'success');
                
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                
                await carregarRedacoes();
            } catch (error) {
                showAlert('Erro: ' + error.message, 'error');
            }
        }

        async function carregarRedacoes() {
            try {
                console.log('üîç Carregando reda√ß√µes...');
                
                const response = await fetch(`${baseURL}/proposta/estudante/${studentId}`, {
                    headers: {
                        'authorization': `Bearer ${token}`,
                        'content-type': 'application/json',
                        'accept': 'application/json',
                        'origin': 'https://redacao.pr.gov.br',
                        'referer': 'https://redacao.pr.gov.br/'
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) throw new Error('Token expirado!');
                    throw new Error('Erro ao buscar reda√ß√µes');
                }

                redacoes = await response.json();
                console.log('‚úÖ Reda√ß√µes:', redacoes.length);
                
                const hoje = new Date();
                const disponiveis = redacoes.filter(r => {
                    const prazo = new Date(r.dtFim);
                    return [1, 2, 3].includes(r.statusRedacao) && prazo >= hoje;
                });

                if (disponiveis.length === 0) {
                    showAlert('‚ùå Nenhuma reda√ß√£o dispon√≠vel', 'warning');
                    return;
                }

                showAlert(`‚úÖ ${disponiveis.length} encontrada(s)!`, 'success');
                renderizarRedacoes(disponiveis);
            } catch (error) {
                showAlert('‚ùå ' + error.message, 'error');
            }
        }

        function renderizarRedacoes(disponiveis) {
            const container = document.getElementById('redacoesList');
            container.innerHTML = '';

            disponiveis.forEach(r => {
                const prazo = new Date(r.dtFim);
                const dias = Math.ceil((prazo - new Date()) / (1000 * 60 * 60 * 24));
                
                let statusClass = 'status-aberto';
                let statusText = 'üîµ Aberto';
                
                if (r.statusRedacao === 2) {
                    statusClass = 'status-rascunho';
                    statusText = 'üü° Rascunho';
                } else if (r.statusRedacao === 3) {
                    statusClass = 'status-correcao';
                    statusText = 'üü† Corre√ß√£o';
                }

                const div = document.createElement('div');
                div.className = 'redacao-item';
                div.onclick = () => selecionarRedacao(r);
                div.innerHTML = `
                    <h3><span class="status-badge ${statusClass}">${statusText}</span>${r.descTema}</h3>
                    <p>üìù ${r.descGenero}</p>
                    <p>üìä ${r.minPalavra}-${r.maxPalavra} palavras</p>
                    <p>üìÖ ${prazo.toLocaleDateString('pt-BR')} (${dias} dias)</p>
                `;
                container.appendChild(div);
            });
        }

        async function selecionarRedacao(redacao) {
            redacaoSelecionada = redacao;
            
            try {
                console.log('üîç Buscando detalhes...');
                
                const response = await fetch(
                    `${baseURL}/proposta/${redacao.idProposta}/estudante/${studentId}`,
                    {
                        headers: {
                            'authorization': `Bearer ${token}`,
                            'content-type': 'application/json',
                            'accept': 'application/json',
                            'origin': 'https://redacao.pr.gov.br',
                            'referer': 'https://redacao.pr.gov.br/'
                        }
                    }
                );

                if (!response.ok) throw new Error('Erro ao carregar');

                const responseText = await response.text();
                let dados = JSON.parse(responseText);
                
                if (typeof dados === 'string') {
                    dados = JSON.parse(dados);
                }
                
                if (!dados || !dados.proposta || !dados.redacao) {
                    throw new Error('Dados incompletos');
                }

                detalhesRedacao = dados;
                console.log('‚úÖ Detalhes OK');

                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step3').classList.remove('hidden');
                document.getElementById('loadingGeneration').classList.remove('hidden');

                await gerarTextoIA();
            } catch (error) {
                showAlert('‚ùå ' + error.message, 'error');
                document.getElementById('step2').classList.remove('hidden');
                document.getElementById('step3').classList.add('hidden');
            }
        }

        async function gerarTextoIA() {
            const d = detalhesRedacao;
            
            const limpar = (texto) => texto.replace(/<[^>]*>/g, '').replace(/&[^;]+;/g, ' ').trim();
            
            const comando = limpar(d.proposta.proposta);
            const textos = d.proposta.textoMotivacional?.map(t => limpar(t.texto)).join('\n\n') || '';

            const prompt = `Escreva uma reda√ß√£o sobre: "${d.proposta.descTema}"

Tipo: ${d.proposta.descGenero}
Palavras: ${d.proposta.minPalvra}-${d.proposta.maxPalavra}

Instru√ß√µes: ${comando}

${textos ? `Textos de apoio:\n${textos}` : ''}

IMPORTANTE:
- Entre ${d.proposta.minPalvra} e ${d.proposta.maxPalavra} palavras
- Linguagem formal
- Apenas o texto, sem t√≠tulo
- Se dissertativo: introdu√ß√£o, desenvolvimento, conclus√£o com proposta`;

            let texto = '';

            if (apiKey && aiProvider === 'groq') {
                try {
                    console.log('ü§ñ Usando Groq...');
                    const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'llama-3.3-70b-versatile',
                            messages: [
                                {role: 'system', content: 'Especialista em reda√ß√£o ENEM.'},
                                {role: 'user', content: prompt}
                            ],
                            temperature: 0.7,
                            max_tokens: 2048
                        })
                    });

                    if (res.ok) {
                        const data = await res.json();
                        texto = data.choices[0].message.content.trim();
                        console.log('‚úÖ Gerado!');
                        showAlert('‚úÖ Texto gerado!', 'success');
                    } else {
                        throw new Error('Falhou');
                    }
                } catch (e) {
                    texto = gerarTextoExemplo();
                    showAlert('‚ö†Ô∏è Usando exemplo', 'warning');
                }
            } else {
                texto = gerarTextoExemplo();
                showAlert('‚ö†Ô∏è Sem IA, usando exemplo', 'warning');
            }

            document.getElementById('loadingGeneration').classList.add('hidden');
            document.getElementById('textEditor').classList.remove('hidden');
            
            document.getElementById('textoRedacao').value = texto;
            document.getElementById('tituloRedacao').value = `Reda√ß√£o - ${redacaoSelecionada.descTema.substring(0, 40)}`;
            
            atualizarContadorPalavras();
            document.getElementById('textoRedacao').addEventListener('input', atualizarContadorPalavras);
        }

        function gerarTextoExemplo() {
            const tema = detalhesRedacao?.proposta?.descTema || 'os desafios';
            return `A sociedade enfrenta desafios relacionados a ${tema}. √â fundamental compreender as m√∫ltiplas dimens√µes que impactam os cidad√£os brasileiros.

No cen√°rio brasileiro, diversos fatores contribuem para a complexidade desta quest√£o. A educa√ß√£o e as pol√≠ticas p√∫blicas s√£o essenciais. A conscientiza√ß√£o √© imprescind√≠vel para uma sociedade justa.

√â necess√°ria a√ß√£o coordenada. O poder p√∫blico, sociedade civil e institui√ß√µes devem desenvolver estrat√©gias integradas. Somente atrav√©s do di√°logo ser√° poss√≠vel superar os obst√°culos.

Portanto, a supera√ß√£o requer esfor√ßo conjunto. Pol√≠ticas eficazes e participa√ß√£o cidad√£ s√£o o caminho para um futuro equitativo.`;
        }

        function atualizarContadorPalavras() {
            const texto = document.getElementById('textoRedacao').value;
            const palavras = texto.trim().split(/\s+/).filter(p => p.length > 0).length;
            const counter = document.getElementById('wordCount');
            
            counter.textContent = `${palavras} palavras`;
            
            const min = detalhesRedacao.proposta.minPalvra;
            const max = detalhesRedacao.proposta.maxPalavra;
            
            if (palavras < min) {
                counter.style.color = '#dc3545';
                counter.textContent += ` (m√≠n: ${min})`;
            } else if (palavras > max) {
                counter.style.color = '#dc3545';
                counter.textContent += ` (m√°x: ${max})`;
            } else {
                counter.style.color = '#28a745';
                counter.textContent += ' ‚úÖ';
            }
        }

        function voltarParaLista() {
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
        }

        async function enviarRedacao() {
            const texto = document.getElementById('textoRedacao').value.trim();
            const titulo = document.getElementById('tituloRedacao').value.trim();

            if (!texto) {
                showAlert('‚ùå Texto vazio!', 'error');
                return;
            }

            const palavras = texto.split(/\s+/).filter(p => p.length > 0).length;
            const min = detalhesRedacao.proposta.minPalvra;
            const max = detalhesRedacao.proposta.maxPalavra;

            if (palavras < min || palavras > max) {
                if (!confirm(`‚ö†Ô∏è ${palavras} palavras (permitido: ${min}-${max}). Continuar?`)) return;
            }

            if (!confirm(`Confirmar envio?\n\nTema: ${redacaoSelecionada.descTema}\nPalavras: ${palavras}\n\nEnviar?`)) return;

            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.remove('hidden');

            try {
                await processarEnvio(texto, titulo);
            } catch (error) {
                showAlert('‚ùå ' + error.message, 'error');
                document.getElementById('step4').classList.add('hidden');
                document.getElementById('step3').classList.remove('hidden');
            }
        }

        async function processarEnvio(texto, titulo) {
            const uIdRedacao = detalhesRedacao.redacao.uIdRedacao;
            const essayId = redacaoSelecionada.idProposta;

            try {
                updateProgress(10, 'üíæ Salvando...', 'stepSave');
                await salvarRascunho(uIdRedacao, essayId, texto, titulo);
                updateProgress(25, '‚úÖ Salvo!');

                updateProgress(30, 'üîç Ortografia...', 'stepSpell');
                await corrigirOrtografia(uIdRedacao, essayId, texto, titulo);
                updateProgress(50, '‚úÖ Verificado!');

                updateProgress(50, '‚è≥ Aguardando...', 'stepWait');
                for (let i = 0; i < 25; i++) {
                    await new Promise(r => setTimeout(r, 1000));
                    updateProgress(50 + ((i + 1) / 25 * 25), `‚è≥ ${25 - i}s`);
                }

                updateProgress(80, 'üì§ Enviando...', 'stepSend');
                await enviarParaCorrecao(uIdRedacao, essayId, texto, titulo);
                updateProgress(100, 'üéâ Sucesso!');
                
                setTimeout(() => showAlert('‚úÖ Reda√ß√£o enviada!', 'success'), 1000);
            } catch (error) {
                console.error('‚ùå Erro:', error);
                throw error;
            }
        }

        function updateProgress(percent, text, stepId = null) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.width = percent + '%';
            progressBar.textContent = Math.round(percent) + '%';
            progressText.textContent = text;

            if (stepId) {
                document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                document.getElementById(stepId).classList.add('active');
                
                const steps = ['stepSave', 'stepSpell', 'stepWait', 'stepSend'];
                const currentIndex = steps.indexOf(stepId);
                for (let i = 0; i < currentIndex; i++) {
                    document.getElementById(steps[i]).classList.add('completed');
                }
            }
        }

        async function salvarRascunho(uIdRedacao, essayId, texto, titulo) {
            const response = await fetch(`${baseURL}/redacao/salvar/${uIdRedacao}`, {
                method: 'POST',
                headers: {
                    'authorization': `Bearer ${token}`,
                    'content-type': 'application/json',
                    'accept': 'application/json',
                    'origin': 'https://redacao.pr.gov.br',
                    'referer': 'https://redacao.pr.gov.br/'
                },
                body: JSON.stringify({essayId, text: texto, title: titulo, status: 2})
            });

            if (!response.ok) throw new Error('Erro ao salvar');
            
            const text = await response.text();
            return text ? JSON.parse(text) : null;
        }

        async function corrigirOrtografia(uIdRedacao, essayId, texto, titulo) {
            const response = await fetch(`${baseURL}/correcao/ortografia/${uIdRedacao}`, {
                method: 'POST',
                headers: {
                    'authorization': `Bearer ${token}`,
                    'content-type': 'application/json',
                    'accept': 'application/json',
                    'origin': 'https://redacao.pr.gov.br',
                    'referer': 'https://redacao.pr.gov.br/'
                },
                body: JSON.stringify({essayId, studentId, text: texto, title: titulo, status: 3})
            });

            if (!response.ok) throw new Error('Erro na ortografia');
            
            const text = await response.text();
            return text ? JSON.parse(text) : null;
        }

        async function enviarParaCorrecao(uIdRedacao, essayId, texto, titulo) {
            const response = await fetch(`${baseURL}/redacao/enviar-para-correcao/${uIdRedacao}`, {
                method: 'POST',
                headers: {
                    'authorization': `Bearer ${token}`,
                    'content-type': 'application/json',
                    'accept': 'application/json',
                    'origin': 'https://redacao.pr.gov.br',
                    'referer': 'https://redacao.pr.gov.br/'
                },
                body: JSON.stringify({essayId, text: texto, title: titulo, status: 4})
            });

            if (!response.ok) throw new Error('Erro ao enviar');
            
            const text = await response.text();
            return text ? JSON.parse(text) : null;
        }

        console.log('üéì Sistema carregado!');
    </script>
</body>
</html>
